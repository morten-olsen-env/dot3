#!/bin/bash

if [ ! -f "$HOME/.pushn" ]; then
  echo "No settings file in ~/.pushn"
  exit 1
fi

source "$HOME/.pushn"

if [[ ! -z "$1" ]]; then
  MESSAGE="$USER@$HOST: $1"
else
  MESSAGE="$USER@$HOST: $(</dev/stdin)"
  echo $MESSAGE
fi

curl -s \
  --form-string "token=$APP_TOKEN" \
  --form-string "user=$USER_KEY" \
  --form-string "message=$MESSAGE" \
  https://api.pushover.net/1/messages.json > /dev/null
